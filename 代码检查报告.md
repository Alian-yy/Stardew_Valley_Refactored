# æ˜Ÿéœ²è°·é¡¹ç›®ä»£ç æ£€æŸ¥æŠ¥å‘Š

## ä¸€ã€ç¼–è¯‘é”™è¯¯å’Œè¯­æ³•é—®é¢˜

#### 2. **Plantingcrops.h - Crop ç±»æ‰¾ä¸åˆ°å®ç°ï¼ˆç¼ºå°‘cppæ–‡ä»¶ï¼‰**
```cpp
// Plantingcrops.h å®šä¹‰äº† Crop ç±»ï¼Œä½†æ‰¾ä¸åˆ°å¯¹åº”çš„å®ç°
// å®é™…çš„å®ç°ä»£ç åœ¨ CropDecorator.cpp ä¸­è¢«æ³¨é‡Šæ‰äº†
```
**é—®é¢˜**ï¼š`Crop::create()` æ–¹æ³•çš„å®ç°ä¸å®Œæ•´  
**å½±å“**ï¼šç¼–è¯‘æ—¶é“¾æ¥é”™è¯¯  

**éœ€è¦è¡¥å……çš„å®ç°**ï¼š
- `Crop` æ„é€ å‡½æ•°å®Œæ•´åˆå§‹åŒ–
- `Crop::create()` å·¥å‚æ–¹æ³•
- `Crop::init()` åˆå§‹åŒ–æ–¹æ³•
- æ‰€æœ‰è™šå‡½æ•°å®ç°
---

#### 3. **Animal.h - åŒ…å«é¡ºåºé”™è¯¯ï¼ˆå¾ªç¯ä¾èµ–ï¼‰**
```cpp
// Animal.h
#include "AnimalState.h"  // âš ï¸ å‰å‘å£°æ˜
// ...
class Animal : public Sprite {
    std::unique_ptr<AnimalState> currentState;
};
```

```cpp
// AnimalState.h
#include "Animal.h"  // âš ï¸ ç›¸äº’åŒ…å«
// ...
class AnimalState {
    virtual void enter(Animal* animal) = 0;
};
```

**é—®é¢˜**ï¼šç›¸äº’åŒ…å«ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–  
**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
```cpp
// Animal.h - æ”¹ä¸ºå‰å‘å£°æ˜
class AnimalState;

class Animal : public Sprite {
    std::unique_ptr<AnimalState> currentState;
};
```


#### 5. **CropDecorator.h - ç¼ºå°‘åŒ…å«å¤´æ–‡ä»¶**
```cpp
// CropDecorator.h
#include "Plantingcrops.h"  // âš ï¸ ä½† Plantingcrops.h å®é™…å®šä¹‰åœ¨ Crop ç±»ä¸­
// åº”è¯¥ä½¿ç”¨ï¼š
#include "Crop.h"  // å¦‚æœ Crop æ˜¯ç‹¬ç«‹æ–‡ä»¶
```

---

#### 6. **SceneAdapter.cpp - ç¼ºå°‘å‰å‘å£°æ˜ä¿æŠ¤**
```cpp
#include "valleybegin.h"
#include "menu.h"
#include "outside.h"  // âš ï¸ outside.h æœ‰è¯­æ³•é”™è¯¯ï¼Œä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥
#include "intovalley.h"
#include "othersence.h"
```

---

### ğŸŸ¡ ä¸­ç­‰é—®é¢˜ - æ½œåœ¨è¿è¡Œæ—¶é”™è¯¯

#### 7. **Animal.cpp - è™šææ„å‡½æ•°æœªå®šä¹‰**
```cpp
// Animal.h
class Animal : public Sprite {
    virtual ~Animal();  // âœ… å£°æ˜
};

// Animal.cpp
// âŒ æ‰¾ä¸åˆ°å®šä¹‰ - æºæ–‡ä»¶ä¸­æ²¡æœ‰å®ç°
```
**ä¿®æ­£**ï¼šåœ¨ Animal.cpp ä¸­æ·»åŠ 
```cpp
Animal::~Animal() {}
```

---

#### 8. **GameSceneFacade.cpp - å•ä¾‹ç®¡ç†é—®é¢˜**
```cpp
SceneAdapterManager* GameSceneFacade::getAdapterManager() {
    return SceneAdapterManager::getInstance();
}
```
**é—®é¢˜**ï¼š
- æ²¡æœ‰ææ„æ—¶é‡Šæ”¾å•ä¾‹
- æ²¡æœ‰çº¿ç¨‹å®‰å…¨ä¿è¯ï¼ˆéå…³é”®ï¼‰

---

#### 9. **EventCenter.cpp - å†…å­˜æ³„æ¼é£é™©**
```cpp
EventCenter* EventCenter::getInstance() {
    if (!_instance) {
        _instance = new (std::nothrow) EventCenter();
        if (_instance && _instance->init()) {
            _instance->retain();  // âš ï¸ å†…å­˜ç®¡ç†æ··ä¹±
        } else {
            CC_SAFE_DELETE(_instance);
        }
    }
    return _instance;
}
```

**é—®é¢˜**ï¼š
- `retain()` ä¸ Cocos2d-x çš„è‡ªåŠ¨å¼•ç”¨è®¡æ•°å†²çª
- å•ä¾‹æ°¸ä¸é‡Šæ”¾ï¼Œå¯èƒ½é€ æˆèµ„æºæ³„æ¼

**ä¿®æ­£**ï¼šæ”¹ç”¨åŸå§‹å•ä¾‹æ¨¡å¼ï¼Œä¸æ¶‰åŠ Cocos2d-x çš„å¼•ç”¨è®¡æ•°
```cpp
EventCenter* EventCenter::getInstance() {
    static EventCenter instance;
    return &instance;
}
```

---

#### 10. **Plantingcrops.cpp - å¤–éƒ¨å˜é‡æœªå®šä¹‰**
```cpp
// Plantingcrops.cpp
void Crop::harvest() {
    // ...
    cropPositions[grid] = false;  // âš ï¸ ä»å“ªé‡Œæ¥çš„ï¼Ÿ
    recycleCrop(this);            // âš ï¸ recycleCrop å‡½æ•°ä¸å­˜åœ¨
}
```

**é—®é¢˜**ï¼š
- `cropPositions` å®šä¹‰åœ¨ characterAction.cpp
- `recycleCrop()` å®šä¹‰åœ¨ characterAction.hï¼ˆé™æ€å‡½æ•°ï¼‰
- ä¸¤ä¸ªæ–‡ä»¶çš„å…¨å±€å˜é‡æ²¡æœ‰ç»Ÿä¸€ç®¡ç†

---

---

## äºŒã€è®¾è®¡æ¨¡å¼åº”ç”¨åˆ†æ

### âœ… åˆç†åº”ç”¨

#### 1. **å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰- GameSceneFacade**
- **åº”ç”¨**ï¼š`GameSceneFacade` ç»Ÿä¸€ç®¡ç†åœºæ™¯åˆ‡æ¢
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - éšè—å¤æ‚çš„ Director æ“ä½œ
  - æä¾›ç»Ÿä¸€çš„æ¥å£
  - ä¾¿äºä¿®æ”¹åœºæ™¯ç®¡ç†é€»è¾‘

---

#### 2. **é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰- SceneAdapter**
- **åº”ç”¨**ï¼š`ISceneCreator` ç»Ÿä¸€ä¸åŒåœºæ™¯çš„åˆ›å»ºæ¥å£
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - è§£è€¦ `GameSceneFacade` ä¸å…·ä½“åœºæ™¯ç±»
  - æ˜“äºæ·»åŠ æ–°åœºæ™¯
  - å‚æ•°åŒ–åœºæ™¯åˆ›å»º

---

#### 3. **ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰- AnimationStrategy**
- **åº”ç”¨**ï¼š`GenericAnimationStrategy` å¤„ç†ä¸åŒçš„åŠ¨ç”»ç­–ç•¥
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - å°†åŠ¨ç”»åˆ›å»ºé€»è¾‘æŠ½è±¡
  - é¿å…é‡å¤ä»£ç 
  - æ˜“äºæ‰©å±•æ–°çš„åŠ¨ç”»ç±»å‹

---

#### 4. **çŠ¶æ€æ¨¡å¼ï¼ˆStateï¼‰- AnimalState**
- **åº”ç”¨**ï¼š`WanderingState`, `ChasingState`, `RestingState`
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - æ¸…æ™°çš„çŠ¶æ€è½¬æ¢
  - ç¬¦åˆå¼€é—­åŸåˆ™
  - æ˜“äºæ·»åŠ æ–°çŠ¶æ€

---

#### 5. **å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰- AnimalFactory, CropFactory**
- **åº”ç”¨**ï¼šé›†ä¸­åˆ›å»ºåŠ¨ç‰©å’Œä½œç‰©å¯¹è±¡
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - é›†ä¸­ç®¡ç†å¯¹è±¡åˆ›å»ºé€»è¾‘
  - æ˜“äºæ·»åŠ æ–°ç±»å‹

---

#### 6. **è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰- CropDecorator**
- **åº”ç”¨**ï¼šä¸ºä½œç‰©æ·»åŠ ä¸åŒçš„æ•ˆæœï¼ˆåŠ é€Ÿã€äº§é‡æå‡ã€è§†è§‰æ•ˆæœç­‰ï¼‰
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - åŠ¨æ€ç»„åˆå¤šç§æ•ˆæœ
  - é¿å…ç±»çˆ†ç‚¸
  - ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™

---

#### 7. **è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰- EventCenter**
- **åº”ç”¨**ï¼šäº‹ä»¶ç³»ç»Ÿç”¨äºé€šçŸ¥ä½œç‰©çŠ¶æ€å˜åŒ–
- **è¯„ä»·**ï¼šâœ… **è‰¯å¥½**
- **ä¼˜ç‚¹**ï¼š
  - è§£è€¦äº‹ä»¶å‘å¸ƒè€…å’Œè®¢é˜…è€…
  - ä¾¿äºæ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬è€…
  - ç³»ç»Ÿæ‰©å±•æ€§å¼º

---

### ğŸŸ¡ é—®é¢˜æˆ–å†—ä½™

#### 1. **å¯¹è±¡æ± æ¨¡å¼ - å®ç°ä¸å®Œæ•´**
```cpp
// characterAction.h ä¸­å®šä¹‰çš„é™æ€å¯¹è±¡æ± 
static std::vector<Crop*> cropPool;
static std::map<std::string, std::vector<Sprite*>> toolPool;
```

**é—®é¢˜**ï¼š
- ğŸ”´ **è‡´å‘½ç¼ºé™·**ï¼šå¯¹è±¡æ± ä»æœªè¢«åˆå§‹åŒ–ï¼
- ğŸ”´ **æ²¡æœ‰åˆå§‹åŒ–å‡½æ•°**æ¥é¢„åˆ›å»ºå¯¹è±¡
- ğŸ”´ **æ²¡æœ‰å¤§å°é™åˆ¶**é˜²æ­¢æ— é™å¢é•¿
- ğŸ”´ **æ²¡æœ‰çº¿ç¨‹å®‰å…¨ä¿è¯**
- ğŸ”´ **å›æ”¶å‡½æ•°å®ç°æœ‰é—®é¢˜**ï¼ˆ`recycleCrop()` åœ¨ Plantingcrops.cpp ä¸­è°ƒç”¨ï¼Œä½†å®ç°åœ¨ characterAction.hï¼‰

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
```cpp
class CropPool {
private:
    std::vector<Crop*> pool;
    const int MAX_SIZE = 50;
    
public:
    static CropPool* getInstance() {
        static CropPool instance;
        return &instance;
    }
    
    Crop* acquire() {
        if (!pool.empty()) {
            Crop* c = pool.back();
            pool.pop_back();
            c->reset();
            return c;
        }
        return Crop::create();
    }
    
    void release(Crop* c) {
        if (c && pool.size() < MAX_SIZE) {
            c->reset();
            c->setVisible(false);
            pool.push_back(c);
        }
    }
};
```

---

#### 2. **ç”Ÿæˆå™¨æ¨¡å¼ï¼ˆBuilderï¼‰- AnimationBuilder**
```cpp
// characterAction.h
class AnimationBuilder {
    AnimationBuilder& from(const std::string& p) { ... }
    AnimationBuilder& frames(int a, int b) { ... }
    AnimationBuilder& delay(float d) { ... }
    Animation* build() { ... }
};
```

**è¯„ä»·**ï¼šâœ… **è‰¯å¥½**  
ä½†æ”¹è¿›ç©ºé—´ï¼š
- åº”è¯¥æœ‰ `reset()` æ–¹æ³•æ¸…ç©ºçŠ¶æ€
- ç¼ºå°‘å¼‚å¸¸å¤„ç†ï¼ˆå¸§æ•°ä¸åŒ¹é…ï¼‰

---

#### 3. **å•ä¾‹æ¨¡å¼ - å¤šå¤„ä½¿ç”¨**
```cpp
// åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ä¸åŒçš„å•ä¾‹å®ç°
GameTimeSystem::getInstance()
EventCenter::getInstance()
SceneAdapterManager::getInstance()
SceneStateManager::getInstance()
```

**é—®é¢˜**ï¼š
- å•ä¾‹å®ç°æ–¹å¼ä¸ä¸€è‡´
- æœ‰äº›ä½¿ç”¨äº† `new`ï¼Œæœ‰äº›ä½¿ç”¨äº† `static`
- å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼

---

### âŒ æ¨¡å¼æ»¥ç”¨æˆ–ç¼ºå¤±

#### 1. **ç¼ºå°‘æ¨¡å¼ï¼šå‘½ä»¤æ¨¡å¼ï¼ˆCommandï¼‰**
æ¨èåœ¨ä»¥ä¸‹åœ°æ–¹åº”ç”¨ï¼š
- é”®ç›˜è¾“å…¥å¤„ç†ï¼ˆç§»åŠ¨ã€ä½¿ç”¨å·¥å…·ï¼‰
- èƒ½å¤Ÿæ”¯æŒæ’¤é”€/é‡åš

#### 2. **ç¼ºå°‘æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰**
æ¨èåœ¨ä»¥ä¸‹åœ°æ–¹åº”ç”¨ï¼š
- `Scene` çš„åˆå§‹åŒ–ã€åŠ è½½ã€å¸è½½
- ä½œç‰©çš„ç”Ÿé•¿é˜¶æ®µ

#### 3. **ç¼ºå°‘æ¨¡å¼ï¼šèŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰**
æ¨èåœ¨ä»¥ä¸‹åœ°æ–¹åº”ç”¨ï¼š
- äº‹ä»¶å¤„ç†ç³»ç»Ÿ
- è§¦æ‘¸/é”®ç›˜äº‹ä»¶åˆ†å‘

---

---

## ä¸‰ã€é‡å¤å’Œé‡å åˆ†æ

---

#### 2. **å…¨å±€å˜é‡è·¨æ–‡ä»¶æ±¡æŸ“**
```cpp
// characterAction.h
extern std::map<Vec2, bool> cropPositions;

// characterAction.cpp
std::map<Vec2, bool> cropPositions;

// Plantingcrops.cpp
// ä½¿ç”¨ cropPositions
```

**é—®é¢˜**ï¼š
- å…¨å±€å˜é‡è¿åå°è£…
- ä¸åŒæ–‡ä»¶éšæ„è®¿é—®
- å®¹æ˜“äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´

**ä¿®æ­£**ï¼šä½¿ç”¨å•ä¾‹ç®¡ç†å†œåœºç½‘æ ¼
```cpp
class FarmGrid {
private:
    std::map<Vec2, bool> cropPositions;
public:
    static FarmGrid* getInstance();
    bool isCropAt(Vec2 grid) const;
    void setCrop(Vec2 grid, bool value);
};
```

---

#### 3. **å¯¹è±¡æ± é‡å¤å®ç°**
```cpp
// characterAction.h
static std::vector<Crop*> cropPool;
static std::map<std::string, std::vector<Sprite*>> toolPool;

// Plantingcrops.cpp
recycleCrop(this);  // è°ƒç”¨ä½†ä¸çŸ¥é“åœ¨å“ªå®šä¹‰

// characterAction.h
recycleCrop(Crop* crop);  // å®šä¹‰
```

**é—®é¢˜**ï¼š
- å¯¹è±¡æ± æ²¡æœ‰ç»Ÿä¸€ç®¡ç†
- å¤šä¸ªå¯¹è±¡ç±»å‹çš„å¯¹è±¡æ± åˆ†æ•£
- åˆå§‹åŒ–å’Œæ¸…ç†é€»è¾‘ä¸æ¸…æ™°

---

#### 4. **åœºæ™¯åˆ›å»ºé€»è¾‘é‡å¤**
```cpp
// outside.cpp ä¸­çš„ createSceneWithMapIndex(int mapIndex)
// SceneAdapter.cpp ä¸­çš„ FarmSceneAdapter::createScene()
// éƒ½æ˜¯è°ƒç”¨ outside::createSceneWithMapIndex(mapIndex)
```

**é—®é¢˜**ï¼šè™½ç„¶ç”¨äº†é€‚é…å™¨ï¼Œä½†åˆ›å»ºé€»è¾‘ä»è¢«å¤åˆ¶

---

---

## å››ã€ç¨‹åºèƒ½å¦è¿è¡Œ

### ğŸ”´ **å½“å‰çŠ¶æ€ï¼šæ— æ³•ç¼–è¯‘è¿è¡Œ**

### ä¸»è¦é˜»ç¢

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | ä¿®å¤éš¾åº¦ |
|------|--------|--------|
| `outside.h` è¯­æ³•é”™è¯¯ï¼ˆåŒé€—å·ï¼‰ | ğŸ”´ ä¸¥é‡ | ğŸŸ¢ ç®€å• |
| å¾ªç¯åŒ…å«ï¼ˆAnimal.h â†” AnimalState.hï¼‰ | ğŸ”´ ä¸¥é‡ | ğŸŸ¢ ç®€å• |
| Crop ç±»å®ç°ä¸å®Œæ•´ | ğŸ”´ ä¸¥é‡ | ğŸŸ¡ ä¸­ç­‰ |
| æ–‡ä»¶åä¸ä¸€è‡´ï¼ˆcharacterAciton.hï¼‰ | ğŸ”´ ä¸¥é‡ | ğŸŸ¢ ç®€å• |
| ç¼ºå¤±é“¾æ¥ï¼ˆrecycleCrop å®ç°ï¼‰ | ğŸ”´ ä¸¥é‡ | ğŸŸ¡ ä¸­ç­‰ |

---

### ä¿®å¤ä¼˜å…ˆçº§æ¸…å•

#### ç¬¬ä¸€é˜¶æ®µï¼ˆç«‹å³ä¿®å¤ - ä½¿èƒ½ç¼–è¯‘ï¼‰
1. âœ… ä¿®å¤ `outside.h` åŒé€—å·é”™è¯¯
2. âœ… è§£å†³ Animal.h â†” AnimalState.h å¾ªç¯ä¾èµ–
3. âœ… ç»Ÿä¸€ characterAciton.h æ–‡ä»¶å
4. âœ… å®Œæˆ Crop ç±»å®ç°ï¼ˆCrop.cppï¼‰
5. âœ… ä¿®å¤ EventCenter å•ä¾‹å®ç°

#### ç¬¬äºŒé˜¶æ®µï¼ˆé“¾æ¥ä¿®å¤ - ä½¿èƒ½é“¾æ¥ï¼‰
6. âœ… ç»Ÿä¸€å…¨å±€å˜é‡ç®¡ç†ï¼ˆcropPositionsï¼‰
7. âœ… å®Œå–„å¯¹è±¡æ± å®ç°å’Œåˆå§‹åŒ–
8. âœ… ç¡®ä¿æ‰€æœ‰è™šææ„å‡½æ•°æœ‰å®ç°

#### ç¬¬ä¸‰é˜¶æ®µï¼ˆè¿è¡Œæ—¶ä¿®å¤ï¼‰
9. âœ… æµ‹è¯•åœºæ™¯åˆ‡æ¢é€»è¾‘
10. âœ… éªŒè¯äº‹ä»¶ç³»ç»Ÿå·¥ä½œæ­£å¸¸
11. âœ… æµ‹è¯•åŠ¨ç‰©å’Œä½œç‰©ç³»ç»Ÿ

---

---

## äº”ã€è®¾è®¡å»ºè®®å’Œæ”¹è¿›æ–¹æ¡ˆ

### 5.1 ä»£ç ç»„ç»‡å»ºè®®

**å»ºè®®çš„é¡¹ç›®ç»“æ„**ï¼š
```
src/
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ GameSceneFacade.h/cpp
â”‚   â”œâ”€â”€ AppDelegate.h/cpp
â”‚   â””â”€â”€ EventCenter.h/cpp
â”œâ”€â”€ Scenes/
â”‚   â”œâ”€â”€ SceneAdapter.h/cpp
â”‚   â”œâ”€â”€ ValleyBegin.h/cpp
â”‚   â”œâ”€â”€ Menu.h/cpp
â”‚   â”œâ”€â”€ Outside.h/cpp
â”‚   â”œâ”€â”€ House.h/cpp
â”‚   â””â”€â”€ OtherArea.h/cpp
â”œâ”€â”€ Characters/
â”‚   â”œâ”€â”€ Character.h/cpp
â”‚   â”œâ”€â”€ Animal.h/cpp
â”‚   â”œâ”€â”€ AnimalState.h
â”‚   â””â”€â”€ AnimationStrategy.h
â”œâ”€â”€ Crops/
â”‚   â”œâ”€â”€ Crop.h/cpp
â”‚   â”œâ”€â”€ CropFactory.h/cpp
â”‚   â”œâ”€â”€ CropDecorator.h/cpp
â”‚   â”œâ”€â”€ CropPool.h/cpp
â”‚   â””â”€â”€ EventData.h
â”œâ”€â”€ Systems/
â”‚   â”œâ”€â”€ GameTimeSystem.h/cpp
â”‚   â”œâ”€â”€ SceneStateManager.h/cpp
â”‚   â”œâ”€â”€ FarmGrid.h/cpp
â”‚   â””â”€â”€ ObjectPool.h/cpp
â””â”€â”€ Utils/
    â”œâ”€â”€ AnimationBuilder.h
    â””â”€â”€ EventType.h
```

---

### 5.2 å…³é”®æ”¹è¿›ç‚¹

#### 1. **ç»Ÿä¸€å¯¹è±¡æ± ç®¡ç†**
```cpp
// ObjectPool.h
template<typename T>
class ObjectPool {
private:
    std::vector<T*> pool;
    std::function<T*()> creator;
    int maxSize;
    
public:
    ObjectPool(std::function<T*()> create, int max = 50)
        : creator(create), maxSize(max) {}
    
    T* acquire() {
        if (!pool.empty()) {
            T* obj = pool.back();
            pool.pop_back();
            return obj;
        }
        return creator();
    }
    
    void release(T* obj) {
        if (obj && pool.size() < maxSize) {
            pool.push_back(obj);
        }
    }
};
```

#### 2. **ç»Ÿä¸€å…¨å±€ç®¡ç†**
```cpp
// FarmContext.h
class FarmContext {
private:
    static FarmContext* instance;
    ObjectPool<Crop> cropPool;
    std::map<Vec2, Crop*> grid;
    
public:
    static FarmContext* getInstance();
    void plantCrop(Vec2 pos, Crop* crop);
    Crop* harvestCrop(Vec2 pos);
    bool isCropAt(Vec2 pos) const;
};
```

#### 3. **æ”¹è¿›å•ä¾‹å®ç°**
```cpp
// ç»Ÿä¸€çš„å•ä¾‹æ¨¡æ¿
template<typename T>
class Singleton {
public:
    static T* getInstance() {
        static T instance;
        return &instance;
    }
    
protected:
    Singleton() = default;
    ~Singleton() = default;
};

// ä½¿ç”¨
class EventCenter : public Singleton<EventCenter> { ... };
class GameTimeSystem : public Singleton<GameTimeSystem> { ... };
```

---

### 5.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯¹è±¡æ± åˆå§‹åŒ–**ï¼šåœ¨æ¸¸æˆå¯åŠ¨æ—¶é¢„åˆ›å»ºå¯¹è±¡
2. **è„æ ‡è®°**ï¼šå‡å°‘ä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°æ£€æŸ¥
3. **ç©ºé—´åˆ†å‰²**ï¼šä½¿ç”¨å››å‰æ ‘å‡å°‘ç¢°æ’æ£€æµ‹
4. **äº‹ä»¶æ‰¹å¤„ç†**ï¼šå°†äº‹ä»¶ç¼“å­˜åç»Ÿä¸€åˆ†å‘

---

---

## å…­ã€æ€»ç»“

### ç°çŠ¶è¯„ä¼°

| æ–¹é¢ | è¯„ä¼° | å¾—åˆ† |
|------|------|------|
| è®¾è®¡æ¨¡å¼ä½¿ç”¨ | å¤§éƒ¨åˆ†æ¨¡å¼åº”ç”¨æ°å½“ | 8/10 |
| ä»£ç ç»„ç»‡ | å­˜åœ¨å¾ªç¯ä¾èµ–å’Œå…¨å±€å˜é‡æ±¡æŸ“ | 5/10 |
| ç¼–è¯‘çŠ¶æ€ | æ— æ³•é€šè¿‡ç¼–è¯‘ | 0/10 |
| å¯ç»´æŠ¤æ€§ | æ¨¡å¼åº”ç”¨è‰¯å¥½ï¼Œä½†å®ç°ä¸å®Œæ•´ | 6/10 |
| å¯æ‰©å±•æ€§ | é€‚é…å™¨å’Œè£…é¥°å™¨è®¾è®¡åˆç† | 8/10 |

### ç«‹å³è¡ŒåŠ¨é¡¹

**éœ€è¦ä¿®å¤çš„å…³é”®é”™è¯¯ï¼š**

```
ä¼˜å…ˆçº§ 1ï¼ˆå¿…é¡»ä¿®å¤ - æ— æ³•ç¼–è¯‘ï¼‰:
  - [ ] outside.h ç¬¬19è¡ŒåŒé€—å·
  - [ ] Animal.h/AnimalState.h å¾ªç¯ä¾èµ–
  - [ ] å®Œæˆ Crop ç±»å®ç°

ä¼˜å…ˆçº§ 2ï¼ˆå¿…é¡»ä¿®å¤ - æ— æ³•é“¾æ¥ï¼‰:
  - [ ] ç»Ÿä¸€å…¨å±€å˜é‡ï¼ˆcropPositionsï¼‰
  - [ ] recycleCrop() å®ç°
  - [ ] è™šææ„å‡½æ•°å®ç°

ä¼˜å…ˆçº§ 3ï¼ˆä¼˜åŒ– - å¯ä»¥è¿è¡Œåå¤„ç†ï¼‰:
  - [ ] æ”¹è¿›å¯¹è±¡æ± å®ç°
  - [ ] ç»Ÿä¸€å•ä¾‹æ¨¡å¼
  - [ ] é‡æ„æ–‡ä»¶ç»„ç»‡ç»“æ„
```

---

### é¡¹ç›®å®Œæˆåº¦è¯„ä¼°

- **è®¾è®¡å±‚é¢**ï¼šâœ… 80% - è®¾è®¡æ¨¡å¼åº”ç”¨è‰¯å¥½
- **å®ç°å±‚é¢**ï¼šâŒ 30% - å¤§é‡å®ç°ç¼ºå¤±æˆ–ä¸å®Œæ•´
- **å¯è¿è¡ŒçŠ¶æ€**ï¼šâŒ 0% - æ— æ³•ç¼–è¯‘
- **æ•´ä½“**ï¼š**é¡¹ç›®éœ€è¦ç´§æ€¥ä¿®å¤æ‰èƒ½è¿è¡Œ**

